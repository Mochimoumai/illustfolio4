var TumblrPosts=function(t){this.option=$.extend({},this.option),this.config(t),this.$=$(this),this.on(this.EVENT_COMPLETE,$.proxy(this._createTagData,this))};!function(t,s){t.EVENT_COMPLETE="complete",t.EVENT_PROGRESS="progress",t.option={url:"/api/read/json/",restPath:"/api/read/json/",domain:null,maxNum:0},t.$=null,t.offset=0,t.step=50,t.posts=[],t.tags=[],t.config=function(t){return"undefined"==typeof t?this.option:"string"==typeof t?this.option[t]:("[object Object]"===Object.prototype.toString.call(t)&&(s.extend(this.option,t),"domain"in t&&this.config("domain")&&this.config({url:"//"+this.config("domain")+this.config("restPath")})),this)},t.on=function(){this.$.on.apply(this.$,arguments)},t.bind=t.on,t.off=function(){this.$.off.apply(this.$,arguments)},t.unbind=t.off,t.trigger=function(){this.$.trigger.apply(this.$,arguments)},t.run=function(t,i){var o,n;if(t){if(!t.posts.length)return void this.trigger(this.EVENT_COMPLETE);for(o=0;o<t.posts.length;o+=1){if(this.posts.length>=this.config("maxNum"))return void this.trigger(this.EVENT_COMPLETE);n=t.posts[o],this.posts.push(n),n.tags&&(this.tags=this.tags.concat(n.tags))}this.offset+=this.step,this.trigger(this.EVENT_PROGRESS)}else this.posts=[],this.tags=[];return s.ajax({url:this.option.url,data:{start:this.offset,num:this.step},dataType:"jsonp",success:s.proxy(this.run,this)}),this},t._createTagData=function(){var t,s,i;for(s={},t=0;t<this.tags.length;t++)i=this.tags[t],s[i]=s[i]?s[i]+1:1;this.tags=[];for(t in s)this.tags.push({name:t,count:s[t]})},t.getPosts=function(t,i){var o=[];return t=t||0,i=i||10,s.each(this.posts,function(s,n){if(!(s<t))return!(s>=t+i)&&void o.push(n)}),o},t.getTags=function(t){var s=this.tags;return t&&s.sort(function(s,i){return"asc"===t?s.count-i.count:"desc"===t?i.count-s.count:void 0}),s},t.getTitleByPost=function(t,s){var i=t["regular-title"]||t["photo-caption"]||t["video-caption"]||t["regular-body"]||t.type||"";return i=i.replace(/\<.+?\>/gi,""),i=s?i.substr(0,s):i}}(TumblrPosts.prototype,jQuery),function(){for(var t=document.querySelectorAll("a"),s=0;s<t.length;s++)t[s].host!==location.host&&t[s].setAttribute("target","_blank")}(),$(document).ready(function(){!function(){var t=new TumblrPosts({domain:location.host,maxNum:300});t.bind(t.EVENT_COMPLETE,function(t){$.each(this.getTags(),function(t,s){var i='<li class="level'+(s.count%6+1)+'"><a href="/tagged/'+s.name+'">'+s.name+"</a></li>";$(i).appendTo($("ul#tags"))})}),t.run()}()});